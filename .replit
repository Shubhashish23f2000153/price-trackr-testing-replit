[nix]
channel = "stable-23_05"

[unitTest]
language = "python3"

[deployment]
deploymentTarget = "cloudrun"

[agent]
expertMode = true

[ports]
# Expose the frontend port (5000) for the webview
localPort = 5000
externalPort = 80

# Expose the backend port (8000) so the extension can reach it
[[ports]]
localPort = 8000
externalPort = 8000

[workflows]
# Define the default "run" button action
runButton = "Run Project"

[[workflows.workflow]]
# This is the main workflow that runs everything
name = "Run Project"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
# --- THIS IS THE UPDATED COMMAND ---
# It now explicitly includes the .env file from the root
args = "docker compose --env-file ./.env -f infra/docker-compose.yml up --build"
# --- END UPDATE ---
# Wait for the frontend port to be ready before opening the webview
waitForPort = 5000

[workflows.workflow.metadata]
outputType = "webview"